local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local Config = {
    Enabled = false,
    Aimbot = {
        Enabled = false,
        FOV = 200,
        ShowFOV = true,
        VisibleCheck = false,
        TeamCheck = true,
        TargetPart = "Head",
        Smoothness = 0.1
    },
    Desync = {
        Enabled = false,
        Type = "Random", -- "Random", "Circle", "Spiral"
        Range = 15,
        Speed = 10,
        VerticalOffset = 5
    },
    SilentAim = {
        Enabled = false,
        HitChance = 100,
        TargetPart = "Head"
    },
    UI = {
        Visible = true,
        Position = UDim2.new(0.02, 0, 0.3, 0)
    }
}

local FOVCircle
local DesyncOffset = Vector3.new(0, 0, 0)
local DesyncAngle = 0
local CurrentTarget = nil
local OriginalNamecall
local OriginalIndex

local function CreateFOVCircle()
    if FOVCircle then
        FOVCircle:Remove()
    end
    
    FOVCircle = Drawing.new("Circle")
    FOVCircle.Thickness = 2
    FOVCircle.NumSides = 50
    FOVCircle.Radius = Config.Aimbot.FOV
    FOVCircle.Color = Color3.fromRGB(255, 255, 255)
    FOVCircle.Transparency = 1
    FOVCircle.Visible = Config.Aimbot.ShowFOV
    FOVCircle.Filled = false
    FOVCircle.ZIndex = 2
end

local function UpdateFOVCircle()
    if not FOVCircle then return end
    
    FOVCircle.Position = Vector2.new(Mouse.X, Mouse.Y + 36)
    FOVCircle.Radius = Config.Aimbot.FOV
    FOVCircle.Visible = Config.Aimbot.ShowFOV and Config.Aimbot.Enabled
end

local function GetCharacter(player)
    return player and player.Character
end

local function GetRootPart(character)
    return character and (character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso"))
end

local function GetTargetPart(character, partName)
    return character and character:FindFirstChild(partName)
end

local function IsAlive(character)
    local humanoid = character and character:FindFirstChildOfClass("Humanoid")
    return humanoid and humanoid.Health > 0
end

local function IsVisible(character)
    if not Config.Aimbot.VisibleCheck then return true end
    
    local targetPart = GetTargetPart(character, Config.Aimbot.TargetPart)
    if not targetPart then return false end
    
    local localChar = GetCharacter(LocalPlayer)
    local localRoot = GetRootPart(localChar)
    if not localRoot then return false end
    
    local ray = Ray.new(localRoot.Position, (targetPart.Position - localRoot.Position).Unit * 1000)
    local hit = Workspace:FindPartOnRayWithIgnoreList(ray, {localChar, Camera})
    
    return hit and hit:IsDescendantOf(character)
end

local function GetClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = Config.Aimbot.FOV
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = GetCharacter(player)
            
            if character and IsAlive(character) then
                if Config.Aimbot.TeamCheck and player.Team == LocalPlayer.Team then
                    continue
                end
                
                if not IsVisible(character) then
                    continue
                end
                
                local targetPart = GetTargetPart(character, Config.Aimbot.TargetPart)
                if targetPart then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    
                    if onScreen then
                        local mousePos = Vector2.new(Mouse.X, Mouse.Y)
                        local distance = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                        
                        if distance < shortestDistance then
                            closestPlayer = player
                            shortestDistance = distance
                        end
                    end
                end
            end
        end
    end
    
    return closestPlayer
end

local function AimbotStep()
    if not Config.Aimbot.Enabled then return end
    
    CurrentTarget = GetClosestPlayer()
    
    if CurrentTarget then
        local character = GetCharacter(CurrentTarget)
        local targetPart = GetTargetPart(character, Config.Aimbot.TargetPart)
        
        if targetPart then
            local targetPos = targetPart.Position
            local cameraPos = Camera.CFrame.Position
            local direction = (targetPos - cameraPos).Unit
            
            local newCFrame = CFrame.new(cameraPos, cameraPos + direction)
            Camera.CFrame = Camera.CFrame:Lerp(newCFrame, Config.Aimbot.Smoothness)
        end
    end
end

local function CalculateDesyncOffset()
    if not Config.Desync.Enabled then 
        return Vector3.new(0, 0, 0)
    end
    
    local range = Config.Desync.Range
    local offset = Vector3.new(0, 0, 0)
    
    if Config.Desync.Type == "Random" then
        offset = Vector3.new(
            math.random(-range, range),
            math.random(-Config.Desync.VerticalOffset, Config.Desync.VerticalOffset),
            math.random(-range, range)
        )
    elseif Config.Desync.Type == "Circle" then
        DesyncAngle = DesyncAngle + (Config.Desync.Speed * 0.1)
        offset = Vector3.new(
            math.cos(DesyncAngle) * range,
            math.sin(DesyncAngle * 2) * Config.Desync.VerticalOffset,
            math.sin(DesyncAngle) * range
        )
    elseif Config.Desync.Type == "Spiral" then
        DesyncAngle = DesyncAngle + (Config.Desync.Speed * 0.1)
        local spiralRange = range * math.sin(DesyncAngle * 0.5)
        offset = Vector3.new(
            math.cos(DesyncAngle) * spiralRange,
            math.sin(DesyncAngle * 3) * Config.Desync.VerticalOffset,
            math.sin(DesyncAngle) * spiralRange
        )
    end
    
    return offset
end

local function ApplyDesync()
    if not Config.Desync.Enabled then return end
    
    local character = GetCharacter(LocalPlayer)
    local rootPart = GetRootPart(character)
    
    if rootPart then
        DesyncOffset = CalculateDesyncOffset()
        s
        rootPart.CFrame = rootPart.CFrame + DesyncOffset
    end
end
local function HookRemote()
    OriginalNamecall = hookmetamethod(game, "__namecall", function(self, ...)
        local args = {...}
        local method = getnamecallmethod()
        
        if Config.SilentAim.Enabled and method == "FireServer" then
            if self.Name == "ReplicateShot" or self.Name == "ShootGun" or self.Name == "Fire" then
                if CurrentTarget and math.random(1, 100) <= Config.SilentAim.HitChance then
                    local character = GetCharacter(CurrentTarget)
                    local targetPart = GetTargetPart(character, Config.SilentAim.TargetPart)
                    
                    if targetPart then
                        -- Modify the shot args to hit the target
                        if #args >= 1 then
                            args[1] = targetPart.Position
                        end
                    end
                end
            end
        end
        
        return OriginalNamecall(self, unpack(args))
    end)
end
local function CreateUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "RagobotUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    MainFrame.BorderColor3 = Color3.fromRGB(255, 0, 0)
    MainFrame.BorderSizePixel = 2
    MainFrame.Position = Config.UI.Position
    MainFrame.Size = UDim2.new(0, 300, 0, 450)
    MainFrame.Active = true
    MainFrame.Draggable = true
    
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Parent = MainFrame
    Title.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    Title.BorderSizePixel = 0
    Title.Size = UDim2.new(1, 0, 0, 35)
    Title.Font = Enum.Font.GothamBold
    Title.Text = "RIVALS RAGEBOT"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 16
    
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Name = "CloseBtn"
    CloseBtn.Parent = Title
    CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    CloseBtn.BorderSizePixel = 0
    CloseBtn.Position = UDim2.new(1, -30, 0, 5)
    CloseBtn.Size = UDim2.new(0, 25, 0, 25)
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseBtn.TextSize = 14
    
    CloseBtn.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)
    
    local ScrollFrame = Instance.new("ScrollingFrame")
    ScrollFrame.Name = "ScrollFrame"
    ScrollFrame.Parent = MainFrame
    ScrollFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    ScrollFrame.BorderSizePixel = 0
    ScrollFrame.Position = UDim2.new(0, 10, 0, 45)
    ScrollFrame.Size = UDim2.new(1, -20, 1, -55)
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 600)
    ScrollFrame.ScrollBarThickness = 6
    
    local yOffset = 10
    
    local function CreateToggle(name, callback, defaultValue)
        local Toggle = Instance.new("Frame")
        Toggle.Name = name
        Toggle.Parent = ScrollFrame
        Toggle.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        Toggle.BorderSizePixel = 0
        Toggle.Position = UDim2.new(0, 5, 0, yOffset)
        Toggle.Size = UDim2.new(1, -10, 0, 30)
        
        local Label = Instance.new("TextLabel")
        Label.Parent = Toggle
        Label.BackgroundTransparency = 1
        Label.Position = UDim2.new(0, 10, 0, 0)
        Label.Size = UDim2.new(1, -50, 1, 0)
        Label.Font = Enum.Font.Gotham
        Label.Text = name
        Label.TextColor3 = Color3.fromRGB(255, 255, 255)
        Label.TextSize = 12
        Label.TextXAlignment = Enum.TextXAlignment.Left
        
        local Button = Instance.new("TextButton")
        Button.Parent = Toggle
        Button.BackgroundColor3 = defaultValue and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
        Button.BorderSizePixel = 0
        Button.Position = UDim2.new(1, -35, 0.5, -10)
        Button.Size = UDim2.new(0, 30, 0, 20)
        Button.Font = Enum.Font.GothamBold
        Button.Text = defaultValue and "ON" or "OFF"
        Button.TextColor3 = Color3.fromRGB(255, 255, 255)
        Button.TextSize = 10
        
        local isEnabled = defaultValue
        Button.MouseButton1Click:Connect(function()
            isEnabled = not isEnabled
            Button.BackgroundColor3 = isEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
            Button.Text = isEnabled and "ON" or "OFF"
            callback(isEnabled)
        end)
        
        yOffset = yOffset + 35
        return Toggle
    end
    
    local function CreateSlider(name, min, max, default, callback)
        local Slider = Instance.new("Frame")
        Slider.Name = name
        Slider.Parent = ScrollFrame
        Slider.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        Slider.BorderSizePixel = 0
        Slider.Position = UDim2.new(0, 5, 0, yOffset)
        Slider.Size = UDim2.new(1, -10, 0, 40)
        
        local Label = Instance.new("TextLabel")
        Label.Parent = Slider
        Label.BackgroundTransparency = 1
        Label.Position = UDim2.new(0, 10, 0, 0)
        Label.Size = UDim2.new(1, -20, 0, 15)
        Label.Font = Enum.Font.Gotham
        Label.Text = name .. ": " .. tostring(default)
        Label.TextColor3 = Color3.fromRGB(255, 255, 255)
        Label.TextSize = 11
        Label.TextXAlignment = Enum.TextXAlignment.Left
        
        local SliderBar = Instance.new("Frame")
        SliderBar.Parent = Slider
        SliderBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        SliderBar.BorderSizePixel = 0
        SliderBar.Position = UDim2.new(0, 10, 0, 20)
        SliderBar.Size = UDim2.new(1, -20, 0, 10)
        
        local SliderFill = Instance.new("Frame")
        SliderFill.Parent = SliderBar
        SliderFill.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        SliderFill.BorderSizePixel = 0
        SliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
        
        local SliderButton = Instance.new("TextButton")
        SliderButton.Parent = SliderBar
        SliderButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        SliderButton.BorderSizePixel = 0
        SliderButton.Position = UDim2.new((default - min) / (max - min), -5, 0.5, -7)
        SliderButton.Size = UDim2.new(0, 10, 0, 14)
        SliderButton.Text = ""
        
        local dragging = false
        SliderButton.MouseButton1Down:Connect(function()
            dragging = true
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        RunService.RenderStepped:Connect(function()
            if dragging then
                local mousePos = UserInputService:GetMouseLocation().X
                local sliderPos = SliderBar.AbsolutePosition.X
                local sliderSize = SliderBar.AbsoluteSize.X
                
                local value = math.clamp((mousePos - sliderPos) / sliderSize, 0, 1)
                local actualValue = math.floor(min + (max - min) * value)
                
                SliderFill.Size = UDim2.new(value, 0, 1, 0)
                SliderButton.Position = UDim2.new(value, -5, 0.5, -7)
                Label.Text = name .. ": " .. tostring(actualValue)
                
                callback(actualValue)
            end
        end)
        
        yOffset = yOffset + 45
        return Slider
    end
    
    local function CreateDropdown(name, options, default, callback)
        local Dropdown = Instance.new("Frame")
        Dropdown.Name = name
        Dropdown.Parent = ScrollFrame
        Dropdown.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        Dropdown.BorderSizePixel = 0
        Dropdown.Position = UDim2.new(0, 5, 0, yOffset)
        Dropdown.Size = UDim2.new(1, -10, 0, 30)
        
        local Label = Instance.new("TextLabel")
        Label.Parent = Dropdown
        Label.BackgroundTransparency = 1
        Label.Position = UDim2.new(0, 10, 0, 0)
        Label.Size = UDim2.new(0.5, -10, 1, 0)
        Label.Font = Enum.Font.Gotham
        Label.Text = name
        Label.TextColor3 = Color3.fromRGB(255, 255, 255)
        Label.TextSize = 12
        Label.TextXAlignment = Enum.TextXAlignment.Left
        
        local Button = Instance.new("TextButton")
        Button.Parent = Dropdown
        Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        Button.BorderSizePixel = 0
        Button.Position = UDim2.new(0.5, 0, 0, 5)
        Button.Size = UDim2.new(0.5, -10, 0, 20)
        Button.Font = Enum.Font.Gotham
        Button.Text = default .. " ▼"
        Button.TextColor3 = Color3.fromRGB(255, 255, 255)
        Button.TextSize = 10
        
        local currentValue = default
        
        Button.MouseButton1Click:Connect(function()
            local currentIndex = table.find(options, currentValue)
            local nextIndex = (currentIndex % #options) + 1
            currentValue = options[nextIndex]
            Button.Text = currentValue .. " ▼"
            callback(currentValue)
        end)
        
        yOffset = yOffset + 35
        return Dropdown
    end
    
    CreateToggle("Aimbot", function(val) 
        Config.Aimbot.Enabled = val 
    end, Config.Aimbot.Enabled)
    
    CreateSlider("Aimbot FOV", 50, 500, Config.Aimbot.FOV, function(val)
        Config.Aimbot.FOV = val
    end)
    
    CreateSlider("Smoothness", 1, 100, Config.Aimbot.Smoothness * 100, function(val)
        Config.Aimbot.Smoothness = val / 100
    end)
    
    CreateToggle("Show FOV", function(val)
        Config.Aimbot.ShowFOV = val
    end, Config.Aimbot.ShowFOV)
    
    CreateToggle("Team Check", function(val)
        Config.Aimbot.TeamCheck = val
    end, Config.Aimbot.TeamCheck)
    
    CreateToggle("Visible Check", function(val)
        Config.Aimbot.VisibleCheck = val
    end, Config.Aimbot.VisibleCheck)
    
    CreateDropdown("Target Part", {"Head", "Torso", "HumanoidRootPart"}, Config.Aimbot.TargetPart, function(val)
        Config.Aimbot.TargetPart = val
    end)
    
    CreateToggle("Desync", function(val)
        Config.Desync.Enabled = val
    end, Config.Desync.Enabled)
    
    CreateDropdown("Desync Type", {"Random", "Circle", "Spiral"}, Config.Desync.Type, function(val)
        Config.Desync.Type = val
    end)
    
    CreateSlider("Desync Range", 5, 50, Config.Desync.Range, function(val)
        Config.Desync.Range = val
    end)
    
    CreateSlider("Desync Speed", 1, 20, Config.Desync.Speed, function(val)
        Config.Desync.Speed = val
    end)
    
    CreateToggle("Silent Aim", function(val)
        Config.SilentAim.Enabled = val
    end, Config.SilentAim.Enabled)
    
    CreateSlider("Hit Chance", 0, 100, Config.SilentAim.HitChance, function(val)
        Config.SilentAim.HitChance = val
    end)
    
    if gethui then
        ScreenGui.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(ScreenGui)
        ScreenGui.Parent = game.CoreGui
    else
        ScreenGui.Parent = game.CoreGui
    end
    
    return ScreenGui
end

RunService.RenderStepped:Connect(function()
    UpdateFOVCircle()
    
    if Config.Aimbot.Enabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        AimbotStep()
    end
end)

RunService.Heartbeat:Connect(function()
    ApplyDesync()
end)

CreateFOVCircle()
CreateUI()
HookRemote()

print("[RIVALS RAGEBOT] Loaded successfully!")
print("[RIVALS RAGEBOT] Press INSERT to toggle UI")

-- Toggle UI with INSERT key
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.Insert then
        local ui = game.CoreGui:FindFirstChild("RagobotUI") or (gethui and gethui():FindFirstChild("RagobotUI"))
        if ui then
            ui.Enabled = not ui.Enabled
        end
    end
end)
